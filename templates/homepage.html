{% extends 'layout.html' %}
{% set title = 'Adviser Allocation System' %}

{% block content %}
<div class="topbar">
  <h2>Adviser Allocation System</h2>
  <div class="datebox"><span>Today: {{ today }}</span><span>Week: {{ week_num }}</span></div>
</div>

<div class="card">
  <h3>Welcome to the Adviser Allocation System</h3>
  <p class="muted">Select an option below to get started:</p>
</div>

<div class="grid-2">
  <!-- Main Features -->
  <div class="card">
    <h4>üìä Availability & Scheduling</h4>
    <p class="muted">View and manage adviser availability and schedules</p>
    <div class="row" style="margin-top: 16px;">
      <a href="/availability/earliest" style="text-decoration: none;">
        <button class="primary">View Earliest Availability</button>
      </a>
      <a href="/availability/schedule" style="text-decoration: none;">
        <button class="primary">View Adviser Schedule</button>
      </a>
      <a href="/availability/matrix" style="text-decoration: none;">
        <button class="primary">Availability Matrix</button>
      </a>
    </div>
  </div>

  <div class="card">
    <h4>üìù Allocation Management</h4>
    <p class="muted">Allocate clients to advisers and manage assignments</p>
    <div class="row" style="margin-top: 16px;">
      <a href="/post/allocate" style="text-decoration: none;">
        <button class="primary">Client Allocation</button>
      </a>
      <a href="/allocations/history" style="text-decoration: none;">
        <button class="primary">Allocation History</button>
      </a>
      <a href="/box/create" style="text-decoration: none;">
        <button class="primary">Create Box Folder</button>
      </a>
    </div>
  </div>

  <div class="card">
    <h4>üîí Closures Management</h4>
    <p class="muted">Manage adviser closures and unavailable periods</p>
    <div class="row" style="margin-top: 16px;">
      <a href="/closures/ui" style="text-decoration: none;">
        <button class="primary">Manage Closures</button>
      </a>
    </div>
  </div>
</div>

<div class="card" style="background: var(--soft-accent); border-color: var(--ok);">
  <h4>‚ÑπÔ∏è System Information</h4>
  <div class="row">
    <div>
      <strong>Version:</strong> <span class="muted">1.0.0</span>
    </div>
    <div>
      <strong>Environment:</strong> <span class="muted">{{ environment }}</span>
    </div>
    <div>
      <strong>Sydney Time:</strong> <span class="muted">{{ sydney_time }}</span>
    </div>
  </div>
</div>

<div class="card">
  <h4>‚ùì Adviser Scheduling FAQ</h4>
  <p class="muted">Quick answers to common scheduling questions.</p>
  <ul class="faq">
    <li>
      <strong>How do I check when an adviser can take a new client?</strong><br />
      Use <em>View Earliest Availability</em> to see the next open week for every adviser, including clarify counts and OOO data.
    </li>
    <li>
      <strong>What if a client needs to start earlier than the suggested adviser?</strong><br />
      Visit <em>View Adviser Schedule</em> and inspect alternative advisers in the ‚ÄúEligible‚Äù list. Reassign via <em>Client Allocation</em> if capacity allows.
    </li>
    <li>
      <strong>How do closures affect availability?</strong><br />
      Add or edit closures in <em>Manage Closures</em>; changes sync into availability tables and the scheduling algorithm automatically.
    </li>
    <li>
      <strong>Where can I see why an adviser is unavailable?</strong><br />
      Hover over the availability rows in <em>View Adviser Schedule</em>‚Äîtooltips show clarify totals, closures, and backlog notes contributing to their status.
    </li>
    <li>
      <strong>Do Box folders update when I reassign a deal?</strong><br />
      Reassign first, then trigger <em>Create Box Folder</em> with the new deal ID; the folder metadata refreshes with the latest adviser/contact info.
    </li>
  </ul>
</div>
{% endblock %}

{% block head %}
<style>
  .card h4 {
    margin: 0 0 8px 0;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .card p.muted {
    margin: 0 0 8px 0;
    font-size: 0.9em;
  }
  
  .primary {
    background: var(--brand);
    border-color: var(--brand);
    color: white;
  }
  
  .primary:hover {
    background: var(--brand-600);
    border-color: var(--brand-600);
  }
  
  .row {
    gap: 8px;
  }
  
  @media (max-width: 600px) {
    .row {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .row button {
      width: 100%;
    }
  }

  .faq {
    margin: 0;
    padding-left: 1.2rem;
  }

  .faq li {
    margin-bottom: 0.75rem;
    line-height: 1.45;
  }
</style>
{% endblock %}
